<!doctype html><html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Lab 3</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="styles.css" type="text/css" />
</head>
<body><div class="main"><div class="tree">
<p><strong>Index</strong></p>
<p><a href="cs306.html">cs306</a></p>

<ol>
<li><a href="cs306--lectures.html">lectures</a></li>
<ol>
<li><a href="cs306--lectures--lecture_1.html">lecture 1</a></li>
<li><a href="cs306--lectures--lecture_2.html">lecture 2</a></li>
<li><a href="cs306--lectures--lecture_3.html">lecture 3</a></li>
<li><a href="cs306--lectures--lecture_4.html">lecture 4</a></li>
<li><a href="cs306--lectures--lecture_5.html">lecture 5</a></li>
</ol>
<li><a href="cs306--algorithms.html">algorithms</a></li>
<ol>
<li><a href="cs306--algorithms--Block_Cipher_Modes.html">Block Cipher Modes</a></li>
<ol>
<li><a href="cs306--algorithms--Block_Cipher_Modes--ECB.html">ECB</a></li>
<li><a href="cs306--algorithms--Block_Cipher_Modes--CBC.html">CBC</a></li>
<ol>
<li><a href="cs306--algorithms--Block_Cipher_Modes--CBC--Chained_CBC.html">Chained CBC</a></li>
</ol>
<li><a href="cs306--algorithms--Block_Cipher_Modes--OFB.html">OFB</a></li>
<li><a href="cs306--algorithms--Block_Cipher_Modes--CTR.html">CTR</a></li>
</ol>
<li><a href="cs306--algorithms--Stream_Cipher_Modes.html">Stream Cipher Modes</a></li>
<li><a href="cs306--algorithms--Encryption.html">Encryption</a></li>
<ol>
<li><a href="cs306--algorithms--Encryption--One_Time_Pad.html">One Time Pad</a></li>
<li><a href="cs306--algorithms--Encryption--classical_ciphers.html">classical ciphers</a></li>
<ol>
<li><a href="cs306--algorithms--Encryption--classical_ciphers--Subsitution_Cipher.html">Subsitution Cipher</a></li>
<ol>
<li><a href="cs306--algorithms--Encryption--classical_ciphers--Subsitution_Cipher--Mono-alphabetic_substituion_cipher.html">Mono-alphabetic substituion cipher</a></li>
</ol>
<li><a href="cs306--algorithms--Encryption--classical_ciphers--Caesar's_Cipher.html">Caesar's Cipher</a></li>
<ol>
<li><a href="cs306--algorithms--Encryption--classical_ciphers--Caesar's_Cipher--Shift_Cipher.html">Shift Cipher</a></li>
<li><a href="cs306--algorithms--Encryption--classical_ciphers--Caesar's_Cipher--Vigenere_cipher.html">Vigenere cipher</a></li>
</ol>
</ol>
<li><a href="cs306--algorithms--Encryption--Substitution_Boxes.html">Substitution Boxes</a></li>
<li><a href="cs306--algorithms--Encryption--DES.html">DES</a></li>
<li><a href="cs306--algorithms--Encryption--AES.html">AES</a></li>
</ol>
<li><a href="cs306--algorithms--Pseudo_randomness.html">Pseudo randomness</a></li>
<ol>
<li><a href="cs306--algorithms--Pseudo_randomness--Linear_congruential_generator.html">Linear congruential generator</a></li>
</ol>
<li><a href="cs306--algorithms--MAC.html">MAC</a></li>
<ol>
<li><a href="cs306--algorithms--MAC--Fixed_Length.html">Fixed Length</a></li>
<li><a href="cs306--algorithms--MAC--Domain_extension.html">Domain extension</a></li>
<li><a href="cs306--algorithms--MAC--CBC.html">CBC</a></li>
</ol>
<li><a href="cs306--algorithms--Authenticated_encryption.html">Authenticated encryption</a></li>
<ol>
<li><a href="cs306--algorithms--Authenticated_encryption--Encrypt-and-authenticate.html">Encrypt-and-authenticate</a></li>
<li><a href="cs306--algorithms--Authenticated_encryption--Authenticate-then-encrypt.html">Authenticate-then-encrypt</a></li>
<li><a href="cs306--algorithms--Authenticated_encryption--Encrypt-then-authenticate.html">Encrypt-then-authenticate</a></li>
</ol>
<li><a href="cs306--algorithms--Hashes.html">Hashes</a></li>
<ol>
<li><a href="cs306--algorithms--Hashes--Constructing.html">Constructing</a></li>
<ol>
<li><a href="cs306--algorithms--Hashes--Constructing--Merkle-Damgard.html">Merkle-Damgard</a></li>
<li><a href="cs306--algorithms--Hashes--Constructing--Davies-Meyer.html">Davies-Meyer</a></li>
</ol>
<li><a href="cs306--algorithms--Hashes--Functions.html">Functions</a></li>
<ol>
<li><a href="cs306--algorithms--Hashes--Functions--MD5.html">MD5</a></li>
<li><a href="cs306--algorithms--Hashes--Functions--SHA1.html">SHA1</a></li>
<li><a href="cs306--algorithms--Hashes--Functions--SHA2.html">SHA2</a></li>
<li><a href="cs306--algorithms--Hashes--Functions--SHA3.html">SHA3</a></li>
</ol>
</ol>
</ol>
<li><a href="cs306--Labs.html">Labs</a></li>
<ol>
<li><a href="cs306--Labs--Lab_3.html">Lab 3</a></li>
</ol></ol></div>
<div class="page"><h1><b><u>Lab 3</u></b></h1><div class="codebox"><div class="codebox"><span style="color:#ad7fa8;font-weight:400">import</span>&nbsp;java.security.Key;&nbsp;<br /><span style="color:#ad7fa8;font-weight:400">import</span>&nbsp;java.security.SecureRandom;&nbsp;<br /><br /><span style="color:#ad7fa8;font-weight:400">import</span>&nbsp;javax.crypto.Cipher;&nbsp;<br /><span style="color:#ad7fa8;font-weight:400">import</span>&nbsp;javax.crypto.KeyGenerator;&nbsp;<br /><span style="color:#ad7fa8;font-weight:400">import</span>&nbsp;java.lang.Math;<br /><br /><span style="color:#888a85;font-weight:400">//</span><br /><span style="color:#888a85;font-weight:400">//&nbsp;encrypt&nbsp;and&nbsp;decrypt&nbsp;using&nbsp;the&nbsp;DES&nbsp;private&nbsp;key&nbsp;algorithm</span><br /><br /><span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">class</span>&nbsp;Symmetric&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;See&nbsp;https://en.wikipedia.org/wiki/Data_Encryption_Standard&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">static</span>&nbsp;<span style="color:#8ae234;font-weight:700">final</span>&nbsp;<span style="color:#8ae234;font-weight:700">int</span>&nbsp;DES_KEY_SIZE&nbsp;=&nbsp;<span style="color:#edd400;font-weight:400">56</span>;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">static</span>&nbsp;<span style="color:#8ae234;font-weight:700">final</span>&nbsp;<span style="color:#8ae234;font-weight:700">int</span>&nbsp;DES_BLOCK_SIZE&nbsp;=&nbsp;<span style="color:#edd400;font-weight:400">64</span>;&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Helper&nbsp;function;&nbsp;XOR&nbsp;two&nbsp;arrays&nbsp;of&nbsp;bytes.&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Stores&nbsp;the&nbsp;result&nbsp;in&nbsp;the&nbsp;first&nbsp;array.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;==&nbsp;DO&nbsp;NOT&nbsp;MODIFY&nbsp;THIS&nbsp;FUNCTION!&nbsp;==<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">static</span>&nbsp;<span style="color:#8ae234;font-weight:700">void</span>&nbsp;mapXOR&nbsp;(<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;a,&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;b)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">int</span>&nbsp;length&nbsp;=&nbsp;Math.min(a.length,&nbsp;b.length);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">for</span>&nbsp;(<span style="color:#8ae234;font-weight:700">int</span>&nbsp;i&nbsp;=&nbsp;<span style="color:#edd400;font-weight:400">0</span>;&nbsp;i&nbsp;&lt;&nbsp;length;&nbsp;i++&nbsp;)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a[i]&nbsp;=&nbsp;(<span style="color:#8ae234;font-weight:700">byte</span>)&nbsp;(&nbsp;a[i]&nbsp;^&nbsp;b[i]&nbsp;);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Helper&nbsp;function;&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;blocks&nbsp;needed<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;to&nbsp;represent&nbsp;byte&nbsp;array&nbsp;a.&nbsp;If&nbsp;a&nbsp;contains&nbsp;a&nbsp;number&nbsp;of<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;bytes&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;multiple&nbsp;of&nbsp;the&nbsp;block&nbsp;size,&nbsp;1&nbsp;extra<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;block&nbsp;is&nbsp;added&nbsp;for&nbsp;padding.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;==&nbsp;DO&nbsp;NOT&nbsp;MODIFY&nbsp;THIS&nbsp;FUNCTION!&nbsp;==<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">static</span>&nbsp;<span style="color:#8ae234;font-weight:700">int</span>&nbsp;numBlocks(<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;a){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">return</span>&nbsp;(a.length&nbsp;%&nbsp;DES_BLOCK_SIZE&nbsp;==&nbsp;<span style="color:#edd400;font-weight:400">0</span>)?&nbsp;a.length&nbsp;/&nbsp;DES_BLOCK_SIZE&nbsp;:&nbsp;a.length&nbsp;/&nbsp;DES_BLOCK_SIZE&nbsp;+<span style="color:#edd400;font-weight:400">1</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Run&nbsp;DES&nbsp;in&nbsp;ECB&nbsp;mode&nbsp;to&nbsp;simulate<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;encrypting/decrypting&nbsp;one&nbsp;block&nbsp;at&nbsp;a&nbsp;time.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;==&nbsp;DO&nbsp;NOT&nbsp;MODIFY&nbsp;THIS&nbsp;FUNCTION!&nbsp;==<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">static</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;customDES(<span style="color:#8ae234;font-weight:700">boolean</span>&nbsp;useDecryptMode,&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;plainText,&nbsp;Key&nbsp;key)&nbsp;<span style="color:#8ae234;font-weight:700">throws</span>&nbsp;Exception&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">if</span>&nbsp;(plainText.length&nbsp;!=&nbsp;DES_BLOCK_SIZE)&nbsp;<span style="color:#000000;font-weight:700">throw</span>&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;Exception(<span style="color:#edd400;font-weight:400">"Blocks&nbsp;must&nbsp;all&nbsp;be&nbsp;the&nbsp;same&nbsp;length"</span>);&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;construct&nbsp;a&nbsp;cipher&nbsp;object&nbsp;using&nbsp;blockwise&nbsp;DES&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cipher&nbsp;cipher&nbsp;=&nbsp;Cipher.getInstance(<span style="color:#edd400;font-weight:400">"DES/ECB/NoPadding"</span>);&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;If&nbsp;called&nbsp;in&nbsp;decrypt&nbsp;mode,&nbsp;set&nbsp;cipher&nbsp;to&nbsp;decrypt&nbsp;mode,&nbsp;otherwise&nbsp;use&nbsp;encrypt&nbsp;mode&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">if</span>(useDecryptMode)&nbsp;cipher.init(Cipher.DECRYPT_MODE,&nbsp;key);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">else</span>&nbsp;cipher.init(Cipher.ENCRYPT_MODE,&nbsp;key);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">return</span>&nbsp;cipher.doFinal(plainText);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Implement&nbsp;DES&nbsp;encryption&nbsp;with&nbsp;CBC&nbsp;mode&nbsp;of&nbsp;operation.&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">static</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;customDESCBCEncrypt(<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;plainText,&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;iv,&nbsp;Key&nbsp;key)&nbsp;<span style="color:#8ae234;font-weight:700">throws</span>&nbsp;Exception&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;	<span style="color:#8ae234;font-weight:700">int</span>&nbsp;blocks&nbsp;=&nbsp;numBlocks(plainText);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;cipherText&nbsp;=&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[blocks&nbsp;*&nbsp;DES_BLOCK_SIZE],&nbsp;buffer&nbsp;=&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[DES_BLOCK_SIZE],&nbsp;workingBlock&nbsp;=&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[DES_BLOCK_SIZE];<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Store&nbsp;the&nbsp;IV&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(iv,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;buffer,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;DES_BLOCK_SIZE);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">for</span>&nbsp;(<span style="color:#8ae234;font-weight:700">int</span>&nbsp;i&nbsp;=&nbsp;<span style="color:#edd400;font-weight:400">0</span>;&nbsp;i&nbsp;&lt;&nbsp;plainText.length;&nbsp;i&nbsp;+=&nbsp;DES_BLOCK_SIZE)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Copy&nbsp;a&nbsp;block&nbsp;of&nbsp;ciphertext&nbsp;into&nbsp;a&nbsp;temp&nbsp;buffer,&nbsp;being<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;careful&nbsp;not&nbsp;to&nbsp;overflow.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(plainText,&nbsp;i,&nbsp;workingBlock,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;Math.min(plainText.length&nbsp;-&nbsp;i,&nbsp;DES_BLOCK_SIZE));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Pad&nbsp;message&nbsp;if&nbsp;not&nbsp;multiple&nbsp;of&nbsp;DES_BLOCK_SIZE.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">if</span>&nbsp;(plainText.length&nbsp;-&nbsp;i&nbsp;&lt;&nbsp;DES_BLOCK_SIZE)&nbsp;<span style="color:#000000;font-weight:700">for</span>&nbsp;(<span style="color:#8ae234;font-weight:700">int</span>&nbsp;j&nbsp;=&nbsp;plainText.length&nbsp;-&nbsp;i;&nbsp;j&nbsp;&lt;&nbsp;workingBlock.length;&nbsp;j++)&nbsp;workingBlock[j]&nbsp;=&nbsp;<span style="color:#edd400;font-weight:400">0x00</span>;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;XOR&nbsp;the&nbsp;ciphertext&nbsp;with&nbsp;either&nbsp;the&nbsp;IV&nbsp;or&nbsp;the&nbsp;result&nbsp;of&nbsp;the&nbsp;previous&nbsp;operation.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapXOR(workingBlock,&nbsp;buffer);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Perform&nbsp;the&nbsp;encryption.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buffer&nbsp;=&nbsp;customDES(<span style="color:#ce5c00;font-weight:400">false</span>,&nbsp;workingBlock,&nbsp;key);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Copy&nbsp;the&nbsp;encrypted&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;buffer.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(buffer,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;cipherText,&nbsp;i,&nbsp;DES_BLOCK_SIZE);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">return</span>&nbsp;cipherText;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Implement&nbsp;DES&nbsp;decryption&nbsp;with&nbsp;CBC&nbsp;mode&nbsp;of&nbsp;operation.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">static</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;customDESCBCDecrypt(<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;cipherText,&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;iv,&nbsp;Key&nbsp;key)&nbsp;<span style="color:#8ae234;font-weight:700">throws</span>&nbsp;Exception&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">int</span>&nbsp;blocks&nbsp;=&nbsp;numBlocks(cipherText);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;buffer&nbsp;=&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[DES_BLOCK_SIZE],&nbsp;workingBlock,&nbsp;ivBuffer&nbsp;=&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[DES_BLOCK_SIZE],&nbsp;plainText&nbsp;=&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[blocks&nbsp;*&nbsp;DES_BLOCK_SIZE];<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Store&nbsp;the&nbsp;IV&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(iv,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;ivBuffer,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;DES_BLOCK_SIZE);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">for</span>&nbsp;(<span style="color:#8ae234;font-weight:700">int</span>&nbsp;i&nbsp;=&nbsp;<span style="color:#edd400;font-weight:400">0</span>;&nbsp;i&nbsp;&lt;&nbsp;cipherText.length;&nbsp;i&nbsp;+=&nbsp;DES_BLOCK_SIZE)&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Copy&nbsp;a&nbsp;block&nbsp;of&nbsp;ciphertext&nbsp;into&nbsp;an&nbsp;input&nbsp;buffer.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(cipherText,&nbsp;i,&nbsp;buffer,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;DES_BLOCK_SIZE);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Decrypt&nbsp;the&nbsp;block.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workingBlock&nbsp;=&nbsp;customDES(<span style="color:#ce5c00;font-weight:400">true</span>,&nbsp;buffer,&nbsp;key);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;XOR&nbsp;IV&nbsp;with&nbsp;the&nbsp;results&nbsp;of&nbsp;the&nbsp;decryption.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mapXOR(workingBlock,&nbsp;ivBuffer);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Set&nbsp;the&nbsp;next&nbsp;IV&nbsp;to&nbsp;be&nbsp;the&nbsp;encrypted&nbsp;block.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(buffer,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;ivBuffer,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;DES_BLOCK_SIZE);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Copy&nbsp;decrypted&nbsp;text&nbsp;block&nbsp;to&nbsp;output&nbsp;buffer.&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(workingBlock,&nbsp;<span style="color:#edd400;font-weight:400">0</span>,&nbsp;plainText,&nbsp;i,&nbsp;DES_BLOCK_SIZE);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">return</span>&nbsp;plainText;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/**<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Main&nbsp;method.&nbsp;Initializes&nbsp;the&nbsp;IV&nbsp;and&nbsp;key,&nbsp;and&nbsp;provides&nbsp;a&nbsp;default&nbsp;message&nbsp;to&nbsp;test&nbsp;with.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;==&nbsp;DO&nbsp;NOT&nbsp;MODIFY&nbsp;THIS&nbsp;FUNCTION!&nbsp;==<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">public</span>&nbsp;<span style="color:#8ae234;font-weight:700">static</span>&nbsp;<span style="color:#8ae234;font-weight:700">void</span>&nbsp;main&nbsp;(String[]&nbsp;args)&nbsp;<span style="color:#8ae234;font-weight:700">throws</span>&nbsp;Exception&nbsp;{<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Generate&nbsp;IV&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecureRandom&nbsp;rand&nbsp;=&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;SecureRandom();&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;iv&nbsp;=&nbsp;<span style="color:#000000;font-weight:700">new</span>&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[DES_BLOCK_SIZE];&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rand.nextBytes(iv);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Generate&nbsp;a&nbsp;key&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KeyGenerator&nbsp;keyGen&nbsp;=&nbsp;KeyGenerator.getInstance(<span style="color:#edd400;font-weight:400">"DES"</span>);&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keyGen.init(DES_KEY_SIZE);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Key&nbsp;key&nbsp;=&nbsp;keyGen.generateKey();&nbsp;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;You&nbsp;can&nbsp;either&nbsp;supply&nbsp;your&nbsp;own&nbsp;string&nbsp;as&nbsp;an&nbsp;argument&nbsp;or&nbsp;use&nbsp;this&nbsp;default&nbsp;string&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;message&nbsp;=<span style="color:#edd400;font-weight:400">""</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#000000;font-weight:700">if</span>(args.length&lt;<span style="color:#edd400;font-weight:400">1</span>){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	message&nbsp;=&nbsp;<span style="color:#edd400;font-weight:400">"Ave&nbsp;Maria!&nbsp;Jungfrau&nbsp;mild,&nbsp;Erhoere&nbsp;einer&nbsp;Jungfrau&nbsp;Flehen,&nbsp;Aus&nbsp;diesem&nbsp;Felsen&nbsp;starr&nbsp;und&nbsp;wild&nbsp;Soll&nbsp;mein&nbsp;Gebet&nbsp;zu&nbsp;dir&nbsp;hin&nbsp;wehen.&nbsp;"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color:#edd400;font-weight:400">"&nbsp;Wir&nbsp;schlafen&nbsp;sicher&nbsp;bis&nbsp;zum&nbsp;Morgen,&nbsp;Ob&nbsp;Menschen&nbsp;noch&nbsp;so&nbsp;grausam&nbsp;sind.&nbsp;O&nbsp;Jungfrau,&nbsp;sieh&nbsp;der&nbsp;Jungfrau&nbsp;Sorgen,&nbsp;O&nbsp;Mutter,&nbsp;hoer&nbsp;"</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;<span style="color:#edd400;font-weight:400">"ein&nbsp;bittend&nbsp;Kind!&nbsp;Ave&nbsp;Maria!"</span>;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<span style="color:#000000;font-weight:700">else</span>&nbsp;message&nbsp;=&nbsp;args[<span style="color:#edd400;font-weight:400">0</span>];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#888a85;font-weight:400">/*&nbsp;Print&nbsp;output&nbsp;*/</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span style="color:#edd400;font-weight:400">"--&nbsp;Encrypting&nbsp;the&nbsp;following&nbsp;message:&nbsp;--"</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(message);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;encrypted&nbsp;=&nbsp;customDESCBCEncrypt(message.getBytes(),&nbsp;iv,&nbsp;key);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span style="color:#edd400;font-weight:400">"\n--&nbsp;Ciphertext&nbsp;(shouldn't&nbsp;be&nbsp;readable):&nbsp;--"</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span style="color:#000000;font-weight:700">new</span>&nbsp;String(encrypted));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#8ae234;font-weight:700">byte</span>[]&nbsp;decrypted&nbsp;=&nbsp;customDESCBCDecrypt(encrypted,&nbsp;iv,&nbsp;key);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span style="color:#edd400;font-weight:400">"\n--&nbsp;Result:&nbsp;--"</span>);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span style="color:#000000;font-weight:700">new</span>&nbsp;String(decrypted));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}</div></div></div></div>
</body></html>